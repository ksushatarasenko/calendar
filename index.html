<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work Calendar</title>
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="manifest" href="manifest.json">
    <script>
        (function () {
            const ua = navigator.userAgent.toLowerCase();
            const isSafari = ua.includes("safari") && !ua.includes("chrome");

            if (isSafari) {
                console.warn("‚ö† Safari detected ‚Äî overriding LockManager entirely");

                // –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω—è–µ–º LockManager ‚Äî –¥–∞–∂–µ –µ—Å–ª–∏ Safari –µ–≥–æ –∏–º–µ–µ—Ç
                navigator.locks = {
                    request: async function (name, callback) {
                        return await callback({
                            name,
                            mode: "exclusive",
                            released: false,
                            release() { /* –Ω–∏—á–µ–≥–æ */ }
                        });
                    }
                };
            }
        })();
    </script>

    <!-- XLSX ‚Äî –í–ê–†–ò–ê–ù–¢ –¢–û–õ–¨–ö–û –û–î–ò–ù! -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.19.3/xlsx.full.min.js"></script> -->

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>

    <!-- ==================== –ú–û–î–ê–õ–ö–ò ==================== -->
    <!-- HTML –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –æ—Ç—á—ë—Ç–æ–≤ -->
    <div id="modalReports" class="modal hidden">
        <div class="modal-window modal-panel">

            <!-- –ö—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è -->
            <div class="modal-close-x" onclick="closeModal('modalReports')">‚úñ</div>

            <h2 class="modal-title">–û—Ç—á—ë—Ç—ã</h2>

            <div class="report-buttons">
                <button id="btnReportWork" class="report-btn">
                    üìÑ –û—Ç—á—ë—Ç –ø–æ —Å–º–µ–Ω–∞–º
                </button>

                <button id="btnReportTasks" class="report-btn">
                    üìù –û—Ç—á—ë—Ç –ø–æ –∑–∞–¥–∞—á–∞–º
                </button>
            </div>

            <!-- <button class="modal-btn cancel" onclick="closeModal('modalReports')">
            –ó–∞–∫—Ä—ã—Ç—å
        </button> -->

        </div>
    </div>

    <!-- modalReportOutput -->
    <div id="modalReportOutput" class="modal hidden">
        <div class="modal-window" style="max-width:900px; max-height:70vh; overflow:auto;">
            <h2 id="reportTitle"></h2>
            <div id="reportContent"></div>
            <button onclick="closeModal('modalReportOutput')" class="close-btn">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
    <!-- modalWork –≤–Ω–µ—Å–µ–Ω–∏–µ —Å–º–µ–Ω—ã-->
    <div id="modalWork" class="modal hidden">
        <div class="modal-window">

            <div class="modal-close-x" onclick="closeModal('modalWork')">‚úñ</div>

            <h2 class="modal-title" id="modalWorkTitle">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è</h2>

            <div class="form-group">
                <label>üìÖ –î–∞—Ç–∞:</label>
                <input type="date" id="workDate">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>üïí –ù–∞—á–∞–ª–æ:</label>
                    <input type="time" id="workStart">
                </div>

                <div class="form-group">
                    <label>üïí –ö–æ–Ω–µ—Ü:</label>
                    <input type="time" id="workEnd">
                </div>
            </div>

            <div class="form-group">
                <label>üìç –ú–µ—Å—Ç–æ:</label>
                <input type="text" id="workPlace">
            </div>

            <div class="form-group">
                <label>üë§ –° –∫–µ–º:</label>
                <input type="text" id="workPartner">
            </div>

            <input type="hidden" id="workId">

            <div class="modal-actions">
                <button id="saveWork" class="modal-btn edit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button id="deleteWork" class="modal-btn delete hidden">üóë –£–¥–∞–ª–∏—Ç—å</button>

            </div>

        </div>
    </div>

    <!-- modalTask –≤–Ω–µ—Å–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏-->
    <div id="modalTask" class="modal hidden">
        <div class="modal-window">

            <!-- –∫—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫ -->
            <div class="modal-close-x" onclick="closeModal('modalTask')">‚úñ</div>

            <h2 class="modal-title" id="modalTaskTitle">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</h2>

            <div class="form-group">
                <label for="taskDate">üìÖ –î–∞—Ç–∞:</label>
                <input type="date" id="taskDate">
            </div>

            <div class="form-row">
                <div class="form-group" style="flex: 1;">
                    <label for="taskTime">‚è± –í—Ä–µ–º—è:</label>
                    <input type="time" id="taskTime">
                </div>
                <div style="width: 16px;"></div>
            </div>

            <div class="form-group">
                <label for="taskTitle">üìù –ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                <input type="text" id="taskTitle" placeholder="–ö–æ—Ä–æ—Ç–∫–æ–µ –∏–º—è –∑–∞–¥–∞—á–∏">
            </div>

            <div class="form-group">
                <label for="taskDescription">üìÑ –û–ø–∏—Å–∞–Ω–∏–µ:</label>
                <textarea id="taskDescription" rows="3"
                    style="resize:vertical; padding:10px; border-radius:8px;"></textarea>
            </div>

            <input type="hidden" id="taskId">

            <div class="modal-actions" style="margin-top:6px;">
                <button id="saveTask" class="modal-btn edit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <!-- –∫–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤–∏–¥–∏–º–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ ‚Äî —Å–∫—Ä–æ–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -->
                <button id="deleteTask" class="modal-btn delete hidden">üóë –£–¥–∞–ª–∏—Ç—å</button>
            </div>

        </div>
    </div>

    <!-- modalDay -->
    <div id="modalDay" class="modal hidden">
        <div class="modal-window">
            <h2 id="dayTitle"></h2>
            <div id="dayWorkInfo"></div>
            <div id="dayTaskInfo"></div>
            <div class="modal-close-x" onclick="closeModal('modalDay')">‚úñ</div>
        </div>
    </div>

    <!-- ==================== UI ==================== -->

    <header class="header">
        <!-- –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ -->
        <div class="header-row top-row">
            <button id="prevMonth"><img src="./image/free-icon-arrow-left-9847479.png" alt=""></button>

            <div id="monthTitle">LISTOPAD 2025</div>

            <button id="nextMonth"><img src="./image/free-icon-arrow-right-1549454.png" alt=""></button>
        </div>

        <!-- –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞ -->
        <div class="header-row bottom-row">
            <button id="exportWeekBtn">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
            <button id="darkToggle">üåô</button>
        </div>

    </header>

    <div id="weekdayHeader" class="calendar-grid weekday-grid"></div>
    <div id="calendarGrid" class="calendar-grid"></div>
    <div id="monthSummary" class="month-summary"></div>

    <button id="fabMenu" class="fab">+</button>

    <div id="fabMenuOptions" class="fab-options hidden">
        <button id="fabAddWork" class="fab-option">–î–æ–±–∞–≤–∏—Ç—å —Å–º–µ–Ω—É</button>
        <button id="fabAddTask" class="fab-option">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
        <button id="reportsBtn" class="fab-option">üìÑ –û—Ç—á—ë—Ç—ã</button>
    </div>

    <!-- ==================== JS (–¢–û–õ–¨–ö–û –û–î–ò–ù –†–ê–ó!) ==================== -->

    <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ JS -->
    <script defer src="js/supabase.js"></script>
    <script defer src="js/ui.js"></script>
    <script defer src="js/calendar.js"></script>
    <script defer src="js/save_task.js"></script>
    <script defer src="js/open_day.js"></script>
    <script defer src="js/reports.js"></script>
    <script src="js/libs/xlsx.full.min.js"></script>
    <script defer src="js/export_to_exel.js"></script>
    <script defer src="js/app.js"></script>

    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("/sw.js")
                .then(() => console.log("Service Worker registered"))
                .catch(err => console.error("SW error:", err));
        }
    </script>
</body>

</html>